<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>GIRLS MOOD</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        
        :root { --bg: #f8fafc; --text: #0f172a; --primary: #ec4899; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Boutons et Champs */
        .btn-primary { background: var(--primary); color: white; font-weight: 800; padding: 15px; border-radius: 14px; text-transform: uppercase; width: 100%; letter-spacing: 1px; transition: transform 0.1s; cursor: pointer; }
        .btn-primary:active { transform: scale(0.98); opacity: 0.9; }
        .input-style { background: #f1f5f9; border: 1px solid rgba(0,0,0,0.05); width: 100%; padding: 15px; border-radius: 14px; outline: none; margin-bottom: 10px; font-weight: 600; }
        
        /* Cartes */
        .card { background: white; padding: 15px; border-radius: 18px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 10px; border: 1px solid rgba(0,0,0,0.02); }
        .glass { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <section id="auth-view" class="flex flex-col justify-center px-8 h-full absolute inset-0 bg-[var(--bg)] z-50 transition-opacity duration-500">
        <div class="text-center mb-8">
            <h1 class="text-5xl font-black italic tracking-tighter">GIRLS<span style="color:var(--primary)">MOOD</span></h1>
            <p class="text-xs opacity-40 uppercase tracking-widest mt-2">Loudressing 2.0</p>
        </div>

        <input type="email" id="email" placeholder="Email..." class="input-style">
        <input type="password" id="password" placeholder="Mot de passe..." class="input-style">
        
        <button onclick="handleLogin()" class="btn-primary mt-2">Se connecter</button>
        <button onclick="handleRegister()" class="text-xs text-center w-full opacity-50 underline mt-6 py-2">Cr√©er un nouveau compte</button>
        
        <p id="error-msg" class="text-red-500 text-xs text-center mt-4 font-bold hidden"></p>
    </section>

    <div id="app-view" class="hidden flex-col h-full relative">
        <header class="p-5 glass flex justify-between items-center z-10">
            <h2 class="font-black italic text-lg">GIRLS<span style="color:var(--primary)">MOOD</span></h2>
            <button onclick="auth.signOut()" class="text-[10px] bg-gray-100 px-3 py-2 rounded-full font-bold uppercase tracking-wide">Sortir</button>
        </header>

        <main class="flex-1 overflow-y-auto p-4 pb-24 hide-scrollbar">
            
            <div class="card">
                <h3 class="text-xs font-black uppercase opacity-40 mb-3">‚ú® Nouveau Dossier</h3>
                <input type="text" id="event-name" placeholder="Nom (ex: Anniv Lou)" class="input-style bg-gray-50">
                <div class="flex gap-2">
                    <input type="date" id="event-date" class="input-style w-1/2 text-xs">
                    <input type="text" id="event-dress" placeholder="Dress Code" class="input-style w-1/2 text-xs">
                </div>
                <button onclick="createEvent()" class="btn-primary text-xs py-3 mt-1">Cr√©er l'√©v√©nement</button>
            </div>

            <div id="events-list" class="space-y-3 mt-6">
                </div>
        </main>
    </div>

    <div id="modal-event" class="hidden fixed inset-0 z-50 bg-[var(--bg)] flex flex-col">
        <div class="p-5 glass flex justify-between items-center">
            <h2 id="modal-title" class="font-black text-2xl italic uppercase" style="color:var(--primary)">Titre</h2>
            <button onclick="closeModal()" class="text-2xl opacity-40 p-2">‚úï</button>
        </div>

        <div class="flex-1 overflow-y-auto p-4 pb-10">
            <div class="bg-pink-50 p-4 rounded-2xl border border-pink-100 mb-6">
                <h3 class="text-xs font-black uppercase mb-2 text-pink-500">Ajouter une tenue üëá</h3>
                <div class="flex gap-2">
                    <input type="text" id="inspo-link" placeholder="Colle ton lien ici..." class="input-style bg-white mb-0 text-xs">
                    <button onclick="addInspo()" class="bg-[var(--primary)] text-white font-bold w-12 rounded-xl text-xl shadow-sm hover:shadow-md transition">+</button>
                </div>
            </div>

            <div id="inspo-grid" class="space-y-4"></div>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION (Loudressing2) ---
        const firebaseConfig = {
          apiKey: "AIzaSyAgLVoCp13V7xanqR7oO_2uGwiTpCaFpAY",
          authDomain: "loudressing2.firebaseapp.com",
          projectId: "loudressing2",
          storageBucket: "loudressing2.firebasestorage.app",
          messagingSenderId: "877161870915",
          appId: "1:877161870915:web:963f894f6be7d63bc006f6"
        };

        // --- 2. INITIALISATION ---
        let auth, db, currentUser, currentEventId;

        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            
            // Surveiller si connect√© ou pas
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    document.getElementById('auth-view').classList.add('hidden');
                    document.getElementById('app-view').classList.remove('hidden');
                    document.getElementById('app-view').classList.add('flex');
                    loadEvents();
                } else {
                    document.getElementById('auth-view').classList.remove('hidden');
                    document.getElementById('app-view').classList.add('hidden');
                    document.getElementById('app-view').classList.remove('flex');
                }
            });

        } catch (e) {
            alert("Erreur de chargement : " + e.message);
        }

        // --- 3. FONCTIONS CONNEXION ---
        async function handleLogin() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            const errBox = document.getElementById('error-msg');
            
            if(!email || !pass) { errBox.innerText = "Remplis tout !"; errBox.classList.remove('hidden'); return; }
            
            try {
                await auth.signInWithEmailAndPassword(email, pass);
            } catch(e) {
                errBox.innerText = "Erreur : " + e.message;
                errBox.classList.remove('hidden');
            }
        }

        async function handleRegister() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                await auth.createUserWithEmailAndPassword(email, pass);
            } catch(e) {
                alert("Erreur cr√©ation : " + e.message);
            }
        }

        // --- 4. FONCTIONS EVENTS ---
        async function createEvent() {
            const name = document.getElementById('event-name').value;
            const date = document.getElementById('event-date').value;
            const dress = document.getElementById('event-dress').value;
            
            if(!name) return alert("Mets un nom !");
            
            try {
                await db.collection('events').add({
                    name: name, date: date, dressCode: dress,
                    creator: currentUser.email.split('@')[0], createdAt: Date.now()
                });
                document.getElementById('event-name').value = "";
                alert("C'est cr√©√© ! Regarde en bas üëá");
            } catch(e) {
                alert("Erreur : " + e.message);
            }
        }

        function loadEvents() {
            db.collection('events').orderBy('createdAt', 'desc').onSnapshot(snap => {
                const list = document.getElementById('events-list');
                if(snap.empty) { list.innerHTML = "<p class='text-center opacity-30 text-xs mt-10'>Aucun √©v√©nement...</p>"; return; }
                
                list.innerHTML = snap.docs.map(doc => `
                    <div onclick="openEvent('${doc.id}', '${doc.data().name}')" class="card cursor-pointer active:scale-95 transition border-l-4 border-[var(--primary)] relative">
                        <div class="flex justify-between items-center">
                            <h3 class="font-black text-xl capitalize">${doc.data().name}</h3>
                            <span class="text-xl opacity-20">‚ûî</span>
                        </div>
                        <div class="text-xs opacity-60 mt-1 font-medium">
                            üìÖ ${doc.data().date || '...'} <span class="mx-1">‚Ä¢</span> üëó ${doc.data().dressCode || '...'}
                        </div>
                    </div>
                `).join('');
            });
        }

        // --- 5. DASHBOARD & PHOTOS ---
        function openEvent(id, name) {
            currentEventId = id;
            document.getElementById('modal-title').innerText = name;
            document.getElementById('modal-event').classList.remove('hidden');
            
            db.collection('events').doc(id).collection('inspos').orderBy('createdAt', 'desc').onSnapshot(snap => {
                const grid = document.getElementById('inspo-grid');
                if(snap.empty) { grid.innerHTML = "<p class='text-center opacity-40 text-xs'>Pas encore de photos...</p>"; return; }
                
                grid.innerHTML = snap.docs.map(doc => {
                    const d = doc.data();
                    const likes = d.likes || [];
                    const isLiked = likes.includes(currentUser.uid);
                    return `
                    <div class="card p-0 overflow-hidden">
                        <img src="${d.url}" class="w-full object-cover max-h-96" onerror="this.src='https://placehold.co/400?text=Lien+Cass√©'">
                        <div class="p-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-[10px] font-bold uppercase opacity-40">Par ${d.user}</span>
                                <button onclick="deleteInspo('${doc.id}', '${d.email}')" class="opacity-20 text-xs">üóë</button>
                            </div>
                            
                            <div class="flex gap-4">
                                <button onclick="toggleLike('${doc.id}', ${isLiked})" class="flex items-center gap-1 font-bold text-sm ${isLiked ? 'text-[var(--primary)]' : 'opacity-40'}">
                                    <span class="text-xl">${isLiked ? '‚ù§Ô∏è' : 'ü§ç'}</span> ${likes.length}
                                </button>
                                <button onclick="addComment('${doc.id}')" class="flex items-center gap-1 font-bold text-sm opacity-40">
                                    <span class="text-xl">üí¨</span> Avis
                                </button>
                            </div>

                            <div class="mt-3 space-y-1 bg-gray-50 p-2 rounded-lg ${(d.comments || []).length === 0 ? 'hidden' : ''}">
                                ${(d.comments || []).map(c => `<div class="text-[11px]"><span class="font-bold text-[var(--primary)]">${c.user}:</span> ${c.text}</div>`).join('')}
                            </div>
                        </div>
                    </div>`;
                }).join('');
            });
        }

        async function addInspo() {
            const url = document.getElementById('inspo-link').value;
            if(!url) return alert("Il faut un lien !");
            await db.collection('events').doc(currentEventId).collection('inspos').add({
                url: url, user: currentUser.email.split('@')[0], email: currentUser.email,
                createdAt: Date.now(), likes: [], comments: []
            });
            document.getElementById('inspo-link').value = "";
        }
        
        async function toggleLike(docId, isLiked) {
            const ref = db.collection('events').doc(currentEventId).collection('inspos').doc(docId);
            if(isLiked) await ref.update({ likes: firebase.firestore.FieldValue.arrayRemove(currentUser.uid) });
            else await ref.update({ likes: firebase.firestore.FieldValue.arrayUnion(currentUser.uid) });
        }
        
        async function addComment(docId) {
            const txt = prompt("Ton commentaire ?");
            if(txt) await db.collection('events').doc(currentEventId).collection('inspos').doc(docId).update({
                comments: firebase.firestore.FieldValue.arrayUnion({ user: currentUser.email.split('@')[0], text: txt })
            });
        }
        
        async function deleteInspo(id, email) {
            if(currentUser.email === email && confirm("Supprimer ?")) await db.collection('events').doc(currentEventId).collection('inspos').doc(id).delete();
        }

        function closeModal() { document.getElementById('modal-event').classList.add('hidden'); }
    </script>
</body>
</html>
